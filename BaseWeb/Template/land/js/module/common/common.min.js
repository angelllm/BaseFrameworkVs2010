define(function(require,exports,module){require("pjax"),require("rain"),require("music");var vm=avalon.define({$id:"page",banner:void 0,bannerindex:1,bannerlist:[],init:function(){vm.createFilter(),vm.initPjax(),vm.mobileNav(),vm.scrollPostion(),vm.initBanner(3),vm.rain(vm.bannerlist[0]),vm.loopRain()},initBanner:function(a){for(var b=0;a>b;b++)vm.bannerlist.push("/Template/land/images/banner-"+b+".jpg")},loopRain:function(){setTimeout(function(){vm.bannerlist.length==vm.bannerindex&&(vm.bannerindex=0),$("#banner").html(""),$("canvas").remove();try{vm.rain(vm.bannerlist[vm.bannerindex]),vm.loopRain(vm.bannerindex++)}catch(a){}},6e4*vm.bannerindex)},rain:function(a){var b=new Image;b.style.opacity=0,b.onload=function(){var a=new RainyDay({image:this});a.rain([[3,2,2]],100),a.rain([[3,3,.88],[5,5,.9],[6,2,1]],100)},b.src=a;var c=document.getElementById("banner");c.appendChild(b),vm.banner=b},scrollPostion:function(){var a=$(".menu_link").offset().top,b=$(".cs_widget_comment").offset().top,c=$(".cs_widget_comment").height(),d=230;$(window).scroll(function(){a+100<$(window).scrollTop()?$(".leftbar").css({position:"fixed",top:"45px"}):$(".leftbar").removeAttr("style"),b+c<$(window).scrollTop()?$(".widget_tag_cloud").css({position:"fixed",top:"55px",width:d+"px"}):$(".widget_tag_cloud").removeAttr("style"),$(window).scrollTop()>100?$(".foot_btn").fadeIn("slow",function(){}):$(".foot_btn").fadeOut("slow",function(){})})},mobileNav:function(){$(".mobile-nav").find("a").on("click",function(){$(".mobile-nav").hide()})},initPjax:function(){$.pjax({selector:".pjax",container:"#content",cache:!1,storage:!0,titleSuffix:"-llm\u5c0f\u5c4bfor\u7ea0\u7ed3\u7684\u72ee\u5b50\u5ea7",beforeSend:function(){},filter:function(){$(this).parent().hasClass("menu-item")&&(avalon.vmodels.box.loadones=!0,avalon.vmodels.box.options={pagesize:10,pageindex:1,w:""})},callback:function(){}})},createFilter:function(){avalon.filters.splitTag=function(a){if(null==a||""==a)return"";for(var b=a.split(","),c="",d=0;d<b.length;d++)c+='<a class="pjax" href="/land/list-0-0-0-'+b[d]+'/" rel="tag">'+b[d]+"</a>";return c}},showmore:function(){$(this).parent().fadeOut(300).next().fadeIn(300)},navigation:function(){$('nav[role="navigation"].mobile-nav').toggle("fast")},addLive:function(a){var b=$(this);b.data("data-live")||$.ajax({url:"/land/addLive/",data:{id:a},type:"post",beforeSend:function(){},success:function(a){var c=parseInt(b.text());b.html('<i class="fa fa-heart-o"></i> '+(c+1)),b.data("data-live","live")},error:function(a){}})},reply:function(a){$("input[name='commite_ref_id']").val(a)},loginshow:function(){0==$(this).attr("data-bind")?($(".login_bg").slideDown(300),$(this).attr("data-bind",1)):1==$(this).attr("data-bind")&&($(".login_bg").slideUp(300),$(this).attr("data-bind",0))},gototop:function(){$("body,html").animate({scrollTop:0},200)},login:function(){var _uname=$("#user_login"),_upwd=$("#user_pass"),_error=$("#login-error"),_submit=$(this),_flag=!0;return _error.empty(),""==$.trim(_uname.val())?(_error.html("\u8bf7\u586b\u5199\u7528\u6237\u540d"),_uname.focus(),_flag=!1):""==$.trim(_upwd.val())&&(_error.html("\u8bf7\u8f93\u5165\u5bc6\u7801"),_upwd.focus(),_flag=!1),_flag?void $.ajax({url:"/land/login/",data:{uname:_uname.val(),upwd:_upwd.val()},type:"post",beforeSend:function(){_submit.attr("disabled","disabled")},success:function(data){data=eval(data)[0],0==data.code?_error.html(data.msg):1==data.code&&($(".login_bg").slideUp(300),_uname.val(""),_upwd.val(""),_submit.parents(".member_login").find("a").eq(0).addClass("hideall").next().removeClass("hideall").find("img").attr("src",data.uface).next().html(data.uname)),_submit.removeAttr("disabled")},error:function(a){_submit.removeAttr("disabled")}}):!1},loginout:function(){var a=$(this);$.ajax({url:"/land/loginout/",data:{},type:"post",beforeSend:function(){},success:function(b){a.addClass("hideall").prev().removeClass("hideall")},error:function(a){}})},search:function(){var a=$("input[name='s']");13===event.keyCode&&($("#from").attr("href","/land/list-0-0-0-"+a.val()+"/").click(),$(this).val("").blur())}});vm.init(),$(window).resize(function(){vm.scrollPostion()})});